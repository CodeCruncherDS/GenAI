Agents Challenge Lab
Challenge format

This is a self-contained, end-to-end builder lab. No external links are required. All code is provided in collapsible sections. Follow the steps to ship an end-to-end support agent with approvals, tools, and eval-style validation.
Overview
You will build a production-grade customer support workflow using the OpenAI Agents SDK. The lab walks from environment setup to deployment-grade validation, including tool creation, approvals, routing, and transcript logging. All instructions, code, and diagrams are included below.
Learning Objectives
Design and configure multiple agents (support planner, knowledge, orders, complaints) with handoffs.
Implement tools for orders, complaints, knowledge lookup, and safe outputs with validations.
Wire approvals, logging, and transcript capture for auditability.
Run end-to-end flows and validate outputs with scripted checks.
Extend the system with an optional stretch challenge.
Prerequisites
Python 3.10+
Shell access on macOS/Linux/Windows
An OpenAI API key exported as OPENAI_API_KEY
Basic familiarity with Python virtual environments
Environment Setup (10 minutes)
Create and activate a virtual environment:
python3 -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
Install dependencies (Agents SDK + fastapi for an optional REST runner):
pip install --upgrade pip
pip install "openai-agents>=0.3.0" fastapi uvicorn pydantic
Export your API key:
export OPENAI_API_KEY=sk-...
Architecture (at a glance)
          ┌────────────────────────┐
          │ User (CLI or REST)     │
          └──────────┬─────────────┘
                     │
             ┌───────▼────────┐
             │ Support Planner │  (routes by intent, enforces approvals)
             └───┬─────┬──────┘
                 │     │
   ┌─────────────▼─┐ ┌─▼──────────────┐
   │ Orders Agent   │ │ Complaints Agent│
   │  • order_tool  │ │  • complaint_tool
   │  • refund_rule │ │  • escalation guard
   └─────────┬─────┘ └──────────┬─────┘
             │                  │
        ┌────▼────┐         ┌───▼────┐
        │ Knowledge│        │ Logger │
        │ Agent    │        │ (transcripts, approvals)
        │ • file search     │
        └─────────┘         └────────┘
Files Provided
All code is included below. Copy each snippet into the indicated filenames.
1) tools.py — core tools with validation
Show Code
2) agents.py — agents, handoffs, approvals, logging
Show Code
3) app.py — simple CLI and optional REST server
Show Code
Step-by-Step Build (40–60 minutes)
Step 1: Assemble tools (orders, complaints)
Copy tools.py.
Validate tool behavior:
python - <<'PY'
from tools import lookup_order, file_complaint
print(lookup_order("A123"))
print(file_complaint("A123","Package arrived damaged."))
PY
Step 2: Define agents, handoffs, approvals, logging
Copy agents.py.
Key behaviors:
Planner routes by intent.
Orders/Complaints tools perform validation.
Approval gate blocks refunds/escalations unless allowed.
Transcripts logged for every turn.
Step 3: Wire CLI and REST harness
Copy app.py.
For CLI:
python app.py
For REST:
uvicorn app:app --reload --port 8000
Step 4: Run core scenarios (Validation)
Order status:
python - <<'PY'
from agents import run_turn
print(run_turn("What's the status of order A123?"))
PY
Expect: concise status from OrdersAgent.
Complaint logging:
python - <<'PY'
from agents import run_turn, TRANSCRIPTS
print(run_turn("I received the wrong item for order B456. Please log a complaint."))
print(TRANSCRIPTS[-2:])
PY
Expect: complaint filed; transcript shows user + agent entries.
Approval path (refund request):
python - <<'PY'
from agents import run_turn
print(run_turn("Refund my order C789."))
PY
Expect: planner notes approval requirement; no unauthorized refunds.
FAQ:
python - <<'PY'
from agents import run_turn
print(run_turn("What are your support hours?"))
PY
Expect: KnowledgeAgent response with hours.
Step 5: Inspect transcripts
python - <<'PY'
from agents import TRANSCRIPTS
from pprint import pprint
pprint(TRANSCRIPTS)
PY
Ensure every turn is logged with timestamps.
Production Hardening Checklist
Approvals: Replace the inline approval_gate with a real approval endpoint or human-in-the-loop UI.
Data sources: Swap the mock knowledge base with File Search or your own vector store tools.
Observability: Send trace outputs to your logging stack; add metrics for tool latency and handoff counts.
Validation: Add pydantic schemas to all tool inputs and enforce safe outputs (no PII or over-promising).
Security: Validate order_id format server-side; authenticate REST callers.
Final Challenge (Stretch)
Implement one of the following extensions and validate with at least one scripted test:
Payments tool: Add a payments_tool to update billing addresses. Require approval for any charge/credit actions.
Multi-turn memory: Persist short-term memory per session; ensure the planner uses prior intents.
File Search handoff: Add a File Search tool to KnowledgeAgent for real docs. Include a validation script that checks for citation presence in answers.
Validation Template for Stretch
Show Code
from agents import run_turn

tests = [
    ("Update my billing address for order A123", "billing"),
    ("What documents support hours?", "hours"),
]

for q, tag in tests:
    reply = run_turn(q).lower()
    assert tag in reply, f"Missing expected tag '{tag}' in reply: {reply}"
print("Stretch validations passed.")